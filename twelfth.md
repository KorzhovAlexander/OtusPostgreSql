# Домашнее задание
## Работа с join'ами, статистикой

### Цель:
- знать и уметь применять различные виды join'ов
- строить и анализировать план выполенения запроса
- оптимизировать запрос
- уметь собирать и анализировать статистику для таблицы

### Описание/Пошаговая инструкция выполнения домашнего задания:

В результате выполнения ДЗ вы научитесь пользоваться различными вариантами соединения таблиц.
В данном задании тренируются навыки:
- написания запросов с различными типами соединений
Необходимо:
1) Реализовать прямое соединение двух или более таблиц
2) Реализовать левостороннее (или правостороннее) соединение двух или более таблиц
3) Реализовать кросс соединение двух или более таблиц
4) Реализовать полное соединение двух или более таблиц
5) Реализовать запрос, в котором будут использованы разные типы соединений
6) Сделать комментарии на каждый запрос
7) К работе приложить структуру таблиц, для которых выполнялись соединения

**Таблицы:**
```sql
create table phones(id integer, city_id integer, phone_number char(12));

create table cities(id integer, city_name char(32));

insert into cities values (1, 'Moscow'), (2, 'Rostov'), (3, 'Spb');

insert into phones(id, city_id, phone_number)
values (1, 1, '+72312223344'), (2, 2, '+79298887761'), (3, 4, '+75556667788'), (4, 3, '+71223334453');
```

**1) Прямое соединение (inner join) таблиц cities и phones по city_id:**
```sql
select *
  from cities c
  join phones p on c.id = p.city_id;
```
```
id|city_name                       |id|city_id|phone_number|
--+--------------------------------+--+-------+------------+
 1|Moscow                          | 1|      1|+72312223344|
 2|Rostov                          | 2|      2|+79298887761|
 3|Spb                             | 4|      3|+71223334453|
```
**Выпал телефон с ID = 3, так как у него указан город с City_ID = 4, которого нет в таблице cities.**

**2) Левостороннее соединение (left join) таблиц phones и cities по city_id:**
```sql
select *
  from phones p
  left join cities c on c.id = p.city_id;
```
```
id|city_id|phone_number|id|city_name                       |
--+-------+------------+--+--------------------------------+
 1|      1|+72312223344| 1|Moscow                          |
 2|      2|+79298887761| 2|Rostov                          |
 3|      4|+75556667788|  |                                |
 4|      3|+71223334453| 3|Spb                             |
```
**Теперь телефон попадает, так как поменялся порядок таблиц и левостороннее соединение позволило его отобразить, хоть у него и нет связки с cities**

**3) Кросс соединение (cross join) таблиц cities и phones:**
```sql
select *
  from cities c
  cross join phones p;
```
```
id|city_name                       |id|city_id|phone_number|
--+--------------------------------+--+-------+------------+
 1|Moscow                          | 1|      1|+72312223344|
 2|Rostov                          | 1|      1|+72312223344|
 3|Spb                             | 1|      1|+72312223344|
 1|Moscow                          | 2|      2|+79298887761|
 2|Rostov                          | 2|      2|+79298887761|
 3|Spb                             | 2|      2|+79298887761|
 1|Moscow                          | 3|      4|+75556667788|
 2|Rostov                          | 3|      4|+75556667788|
 3|Spb                             | 3|      4|+75556667788|
 1|Moscow                          | 4|      3|+71223334453|
 2|Rostov                          | 4|      3|+71223334453|
 3|Spb                             | 4|      3|+71223334453|
```
**Получили декартово произведение записей одной таблицы на другую.**

**4) Полное соединение (full join) таблиц cities и phones:**
```sql
select *
  from cities c
  full join phones p on c.id = p.city_id;
```
```
id|city_name                       |id|city_id|phone_number|
--+--------------------------------+--+-------+------------+
 1|Moscow                          | 1|      1|+72312223344|
 2|Rostov                          | 2|      2|+79298887761|
  |                                | 3|      4|+75556667788|
 3|Spb                             | 4|      3|+71223334453|
```
**В отличие от 1 примера теперь выводятся все телефоны, хоть города в cities нет.**

**5) К запросу из примера 1 добавим ещё раз таблицу phones, но через правостороннее соединение (right join), чтобы телефон без города в cities в итоге отобразился:**
```sql
select *
  from cities c
  join phones p on c.id = p.city_id
  right join phones pp on c.id = pp.city_id;
```
```
id|city_name                       |id|city_id|phone_number|id|city_id|phone_number|
--+--------------------------------+--+-------+------------+--+-------+------------+
 1|Moscow                          | 1|      1|+72312223344| 1|      1|+72312223344|
 2|Rostov                          | 2|      2|+79298887761| 2|      2|+79298887761|
 3|Spb                             | 4|      3|+71223334453| 4|      3|+71223334453|
  |                                |  |       |            | 3|      4|+75556667788|
```